Homework 5
================
Xinyi Lin
11/1/2018

``` r
library(tidyverse)
```

    ## ── Attaching packages ──────────────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──

    ## ✔ ggplot2 3.0.0     ✔ purrr   0.2.5
    ## ✔ tibble  1.4.2     ✔ dplyr   0.7.6
    ## ✔ tidyr   0.8.1     ✔ stringr 1.3.1
    ## ✔ readr   1.1.1     ✔ forcats 0.3.0

    ## ── Conflicts ─────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()

Problem One
===========

``` r
hw5_data_df = tibble(list.files("./data")) %>% 
  janitor::clean_names() %>% 
  mutate(files_name_wd = str_c("./data/", list_files_data),
         files_name = str_replace(list_files_data, ".csv", "")) %>% 
  select(-list_files_data)

head(hw5_data_df)
```

    ## # A tibble: 6 x 2
    ##   files_name_wd     files_name
    ##   <chr>             <chr>     
    ## 1 ./data/con_01.csv con_01    
    ## 2 ./data/con_02.csv con_02    
    ## 3 ./data/con_03.csv con_03    
    ## 4 ./data/con_04.csv con_04    
    ## 5 ./data/con_05.csv con_05    
    ## 6 ./data/con_06.csv con_06

``` r
hw5_tidied_data =
  hw5_data_df %>% 
  mutate(data = map(files_name_wd, read_csv)) %>% 
  bind_rows() %>% 
  unnest() %>% 
  gather(key = week, value = value, week_1:week_8) %>% 
  select(-files_name_wd) %>% 
  separate(files_name, into = c("groups", "id"), sep = "_") %>% 
  mutate(week = str_replace(week, "week_", "")) %>% 
  mutate(week = as.numeric(week)) %>% 
  mutate(value = as.numeric(value)) 

head(hw5_tidied_data)
```

    ## # A tibble: 6 x 4
    ##   groups id     week value
    ##   <chr>  <chr> <dbl> <dbl>
    ## 1 con    01        1  0.2 
    ## 2 con    02        1  1.13
    ## 3 con    03        1  1.77
    ## 4 con    04        1  1.04
    ## 5 con    05        1  0.47
    ## 6 con    06        1  2.37

``` r
hw5_tidied_data %>% 
  ggplot(aes(x = week, y = value, color = id)) +
  #geom_point() +
  geom_line() +
  facet_grid(.~ groups)
```

![](p8105_hw5_xl2836_files/figure-markdown_github/unnamed-chunk-4-1.png)

Through this plot, we can find that the values of subjects in two groups are similar at the beginning. However, the values of subjects in experiment group increased over time while the values of subjects in control group keep the same.

Problem Two
===========

Tidied data
-----------

``` r
homicide_df = read_csv("homicide-data.csv") %>% 
  mutate(city_state = str_c(city, ", ", state))
```

    ## Parsed with column specification:
    ## cols(
    ##   uid = col_character(),
    ##   reported_date = col_integer(),
    ##   victim_last = col_character(),
    ##   victim_first = col_character(),
    ##   victim_race = col_character(),
    ##   victim_age = col_character(),
    ##   victim_sex = col_character(),
    ##   city = col_character(),
    ##   state = col_character(),
    ##   lat = col_double(),
    ##   lon = col_double(),
    ##   disposition = col_character()
    ## )

The original dataset gathered information about homicides in 50 large U.S. cities including the location of the killing, whether an arrest was made and, in most cases, basic demographic information about each victim. It cantains 13 variables and 52179 observations. Main variables are `city`, `state` and `disposition`

Number of total and unsolved homicides
--------------------------------------

``` r
city_total_homicicides =
  homicide_df %>% 
  group_by(city) %>% 
  summarise(n = n()) %>% 
  arrange(desc(n))

head(city_total_homicicides)
```

    ## # A tibble: 6 x 2
    ##   city             n
    ##   <chr>        <int>
    ## 1 Chicago       5535
    ## 2 Philadelphia  3037
    ## 3 Houston       2942
    ## 4 Baltimore     2827
    ## 5 Detroit       2519
    ## 6 Los Angeles   2257

``` r
city_unsolved_homicides =
  homicide_df %>% 
  filter(disposition == "Closed without arrest" | disposition == "Open/No arrest") %>% 
  group_by(city) %>% 
  summarise(n = n()) %>% 
  arrange(desc(n))

head(city_unsolved_homicides)
```

    ## # A tibble: 6 x 2
    ##   city             n
    ##   <chr>        <int>
    ## 1 Chicago       4073
    ## 2 Baltimore     1825
    ## 3 Houston       1493
    ## 4 Detroit       1482
    ## 5 Philadelphia  1360
    ## 6 Los Angeles   1106

Proportion of Baltimore and MD
------------------------------

``` r
two_cities_total_homicicides = 
  city_total_homicicides %>% 
  filter(city == "Baltimore")

two_cities_unsolved_homicicides =
  city_unsolved_homicides %>% 
  filter(city == "Baltimore")

prop_Baltimore = 
  prop.test(two_cities_unsolved_homicicides$n, two_cities_total_homicicides$n)

prop_Baltimore %>% 
  broom::tidy() %>% 
  pull(estimate)
```

    ## [1] 0.6455607

``` r
prop_Baltimore %>% 
  broom::tidy() %>% 
  pull(conf.low)
```

    ## [1] 0.6275625

``` r
prop_Baltimore %>% 
  broom::tidy() %>% 
  pull(conf.high)
```

    ## [1] 0.6631599

``` r
city_total_homicicides =
  city_total_homicicides %>% 
  arrange(city) 

city_unsolved_homicides =
  city_unsolved_homicides %>% 
  arrange(city)
```

``` r
city_prop = 
  city_total_homicicides %>% 
  mutate(parameters = map2(city_unsolved_homicides$n, city_total_homicicides$n, prop.test)) %>% 
  mutate(parameters = map(parameters, broom::tidy)) %>% 
  unnest() %>% 
  janitor::clean_names() %>% 
  select(-n)

head(city_prop)
```

    ## # A tibble: 6 x 9
    ##   city  estimate statistic  p_value parameter conf_low conf_high method
    ##   <chr>    <dbl>     <dbl>    <dbl>     <int>    <dbl>     <dbl> <chr> 
    ## 1 Albu…    0.386   19.1    1.23e- 5         1    0.337     0.438 1-sam…
    ## 2 Atla…    0.383   52.5    4.32e-13         1    0.353     0.415 1-sam…
    ## 3 Balt…    0.646  239.     6.46e-54         1    0.628     0.663 1-sam…
    ## 4 Bato…    0.462    2.27   1.32e- 1         1    0.414     0.511 1-sam…
    ## 5 Birm…    0.434   13.8    2.05e- 4         1    0.399     0.469 1-sam…
    ## 6 Bost…    0.505    0.0407 8.40e- 1         1    0.465     0.545 1-sam…
    ## # ... with 1 more variable: alternative <chr>

Draw a plot
-----------

``` r
city_prop %>% 
  mutate(city = reorder(city, desc(estimate))) %>% 
  ggplot(aes(x = city, y = estimate)) +
  geom_point() +
  geom_errorbar(aes(ymin = conf_low, ymax = conf_high)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

![](p8105_hw5_xl2836_files/figure-markdown_github/unnamed-chunk-11-1.png)
